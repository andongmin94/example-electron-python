#!/bin/bash

###############################################################################
# API ν…μ¤νΈ μ¤ν¬λ¦½νΈ
# 
# μ‚¬μ©λ²•:
#   bash test-api.sh
#   λλ”
#   chmod +x test-api.sh
#   ./test-api.sh
###############################################################################

BASE_URL="http://localhost:4000/api"

echo "β•”β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•—"
echo "β•‘          π§ API ν†µμ‹  μμµμ„ - ν…μ¤νΈ μ¤ν¬λ¦½νΈ           β•‘"
echo "β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•"
echo ""

# μƒ‰μƒ μ •μ
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# ============================================================
# STEP 1: GET μ”μ²­ (κΈ°λ³Έ)
# ============================================================
echo -e "${BLUE}β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•${NC}"
echo -e "${BLUE}π“– STEP 1: GET μ”μ²­ ν…μ¤νΈ${NC}"
echo -e "${BLUE}β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•${NC}"
echo ""
echo -e "${YELLOW}μ”μ²­:${NC} GET $BASE_URL/step1/hello"
echo -e "${YELLOW}μ„¤λ…:${NC} κ°€μ¥ κΈ°λ³Έμ μΈ GET μ”μ²­μ…λ‹λ‹¤"
echo ""

curl -s "$BASE_URL/step1/hello" | jq '.' || echo "μ”μ²­ μ‹¤ν¨"
echo ""
echo ""

# ============================================================
# STEP 2: POST μ”μ²­ (λ°μ΄ν„° μƒμ„±)
# ============================================================
echo -e "${BLUE}β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•${NC}"
echo -e "${BLUE}π“ STEP 2: POST μ”μ²­ ν…μ¤νΈ${NC}"
echo -e "${BLUE}β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•${NC}"
echo ""
echo -e "${YELLOW}μ”μ²­:${NC} POST $BASE_URL/step2/create-data"
echo -e "${YELLOW}μ„¤λ…:${NC} μƒλ΅μ΄ λ°μ΄ν„°λ¥Ό μ„λ²„μ— μ „μ†΅ν•©λ‹λ‹¤"
echo ""

curl -s -X POST "$BASE_URL/step2/create-data" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "ν…μ¤νΈμ μ €",
    "age": 25
  }' | jq '.' || echo "μ”μ²­ μ‹¤ν¨"
echo ""
echo ""

# ============================================================
# STEP 3: GET + URL νλΌλ―Έν„° (νΉμ • λ°μ΄ν„° μ΅°ν)
# ============================================================
echo -e "${BLUE}β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•${NC}"
echo -e "${BLUE}π” STEP 3: URL νλΌλ―Έν„°μ™€ μ—λ¬ μ²λ¦¬ ν…μ¤νΈ${NC}"
echo -e "${BLUE}β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•${NC}"
echo ""

# 3-1. μ΅΄μ¬ν•λ” μ‚¬μ©μ μ΅°ν
echo -e "${YELLOW}3-1) μ΅΄μ¬ν•λ” μ‚¬μ©μ μ΅°ν${NC}"
echo -e "${YELLOW}μ”μ²­:${NC} GET $BASE_URL/step3/users/1"
echo ""
curl -s "$BASE_URL/step3/users/1" | jq '.' || echo "μ”μ²­ μ‹¤ν¨"
echo ""
echo ""

# 3-2. μ΅΄μ¬ν•μ§€ μ•λ” μ‚¬μ©μ μ΅°ν (404 μ—λ¬)
echo -e "${YELLOW}3-2) μ΅΄μ¬ν•μ§€ μ•λ” μ‚¬μ©μ μ΅°ν (404 μ—λ¬ μμƒ)${NC}"
echo -e "${YELLOW}μ”μ²­:${NC} GET $BASE_URL/step3/users/999"
echo ""
curl -s "$BASE_URL/step3/users/999" | jq '.' || echo "μ”μ²­ μ‹¤ν¨"
echo ""
echo ""

# ============================================================
# STEP 4: μΏΌλ¦¬ νλΌλ―Έν„° (κ²€μƒ‰ λ° ν•„ν„°λ§)
# ============================================================
echo -e "${BLUE}β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•${NC}"
echo -e "${BLUE}π” STEP 4: μΏΌλ¦¬ νλΌλ―Έν„° ν…μ¤νΈ${NC}"
echo -e "${BLUE}β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•${NC}"
echo ""

# 4-1. κΈ°λ³Έ κ²€μƒ‰
echo -e "${YELLOW}4-1) κΈ°λ³Έ κ²€μƒ‰${NC}"
echo -e "${YELLOW}μ”μ²­:${NC} GET $BASE_URL/step4/search?keyword=ν™"
echo ""
curl -s "$BASE_URL/step4/search?keyword=ν™" | jq '.' || echo "μ”μ²­ μ‹¤ν¨"
echo ""
echo ""

# 4-2. νμ΄μ§€λ„¤μ΄μ… ν¬ν•¨ κ²€μƒ‰
echo -e "${YELLOW}4-2) νμ΄μ§€λ„¤μ΄μ… ν¬ν•¨ κ²€μƒ‰${NC}"
echo -e "${YELLOW}μ”μ²­:${NC} GET $BASE_URL/step4/search?keyword=ν™&page=1&limit=5"
echo ""
curl -s "$BASE_URL/step4/search?keyword=ν™&page=1&limit=5" | jq '.' || echo "μ”μ²­ μ‹¤ν¨"
echo ""
echo ""

# ============================================================
# STEP 5: CRUD μ‘μ—… (μ „μ²΄)
# ============================================================
echo -e "${BLUE}β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•${NC}"
echo -e "${BLUE}β™οΈ  STEP 5: CRUD μ‘μ—… ν…μ¤νΈ${NC}"
echo -e "${BLUE}β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•${NC}"
echo ""

# 5-1. λ¨λ“  μ‚¬μ©μ μ΅°ν
echo -e "${YELLOW}5-1) λ¨λ“  μ‚¬μ©μ μ΅°ν (READ)${NC}"
echo -e "${YELLOW}μ”μ²­:${NC} GET $BASE_URL/step5/users"
echo ""
curl -s "$BASE_URL/step5/users" | jq '.' || echo "μ”μ²­ μ‹¤ν¨"
echo ""
echo ""

# 5-2. μƒλ΅μ΄ μ‚¬μ©μ μƒμ„±
echo -e "${YELLOW}5-2) μƒλ΅μ΄ μ‚¬μ©μ μƒμ„± (CREATE)${NC}"
echo -e "${YELLOW}μ”μ²­:${NC} POST $BASE_URL/step5/users"
echo ""
RESPONSE=$(curl -s -X POST "$BASE_URL/step5/users" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "curlν…μ¤νΈμ μ €",
    "email": "curl@example.com"
  }')
echo "$RESPONSE" | jq '.'
NEW_USER_ID=$(echo "$RESPONSE" | jq -r '.data.id // empty')
echo ""
echo ""

# 5-3. μ‚¬μ©μ μ •λ³΄ μ „μ²΄ μμ • (PUT)
if [ ! -z "$NEW_USER_ID" ]; then
  echo -e "${YELLOW}5-3) μ‚¬μ©μ μ •λ³΄ μ „μ²΄ μμ • (UPDATE - PUT)${NC}"
  echo -e "${YELLOW}μ”μ²­:${NC} PUT $BASE_URL/step5/users/$NEW_USER_ID"
  echo -e "${YELLOW}μ„¤λ…:${NC} λ¨λ“  ν•„λ“λ¥Ό λ‹¤μ‹ μ§€μ •ν•΄μ•Ό ν•©λ‹λ‹¤"
  echo ""
  curl -s -X PUT "$BASE_URL/step5/users/$NEW_USER_ID" \
    -H "Content-Type: application/json" \
    -d '{
      "name": "μμ •λμ΄λ¦„",
      "email": "updated@example.com"
    }' | jq '.'
  echo ""
  echo ""

  # 5-4. μ‚¬μ©μ μ •λ³΄ λ¶€λ¶„ μμ • (PATCH)
  echo -e "${YELLOW}5-4) μ‚¬μ©μ μ •λ³΄ λ¶€λ¶„ μμ • (UPDATE - PATCH)${NC}"
  echo -e "${YELLOW}μ”μ²­:${NC} PATCH $BASE_URL/step5/users/$NEW_USER_ID"
  echo -e "${YELLOW}μ„¤λ…:${NC} ν•„μ”ν• ν•„λ“λ§ μ§€μ •ν•©λ‹λ‹¤ (μ΄λ©”μΌμ€ μ μ§€λ¨)"
  echo ""
  curl -s -X PATCH "$BASE_URL/step5/users/$NEW_USER_ID" \
    -H "Content-Type: application/json" \
    -d '{
      "name": "ν¨μΉλ΅μμ •"
    }' | jq '.'
  echo ""
  echo ""

  # 5-5. μ‚¬μ©μ μ‚­μ 
  echo -e "${YELLOW}5-5) μ‚¬μ©μ μ‚­μ  (DELETE)${NC}"
  echo -e "${YELLOW}μ”μ²­:${NC} DELETE $BASE_URL/step5/users/$NEW_USER_ID"
  echo ""
  curl -s -X DELETE "$BASE_URL/step5/users/$NEW_USER_ID" | jq '.'
  echo ""
else
  echo -e "${RED}β οΈ  μƒλ΅μ΄ μ‚¬μ©μ μƒμ„±μ— μ‹¤ν¨ν•μ—¬ UPDATE/DELETE ν…μ¤νΈλ¥Ό κ±΄λ„λλ‹λ‹¤${NC}"
  echo ""
fi

echo ""
echo -e "${GREEN}β•”β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•—${NC}"
echo -e "${GREEN}β•‘            β… λ¨λ“  ν…μ¤νΈ μ™„λ£!                        β•‘${NC}"
echo -e "${GREEN}β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•${NC}"
echo ""
echo "π“ λ” μ•μ•„λ³΄κΈ°:"
echo "  - μ „μ²΄ κ°€μ΄λ“: API_TUTORIAL_GUIDE.md μ½κΈ°"
echo "  - λΉ λ¥Έ μ‹μ‘: QUICK_START.md μ½κΈ°"
echo "  - ν”„λ΅ νΈμ—”λ“: http://localhost:3000 λ°©λ¬Έ"
echo ""
